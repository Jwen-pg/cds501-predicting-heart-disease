---
title: "CDS505 Project"
output: pdf_document
---

# Loading Libraries

```{r}
library(varhandle)
library(corrplot)
library(ggplot2)
```

# Loading Data

```{r}
# sets directory of current file as working directory
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

# reads dataset
data <- read.csv2("../data/cardio.csv")

# drops 'id' attribute from the dataset
data <- subset(data, select = -c(id))

# recoding categorical or ordered data into readable format
data$cardio <- as.factor(ifelse(data$cardio == 0, "Negative", "Positive"))
data$active <- as.factor(ifelse(data$active == 0, "Inactive", "Active"))
data$alco <- as.factor(ifelse(data$alco == 0, "Non-alcoholic", "Alcoholic"))
data$smoke <- as.factor(ifelse(data$smoke == 0, "Non-smoker", "Smoker"))
data$gluc <- as.ordered(ifelse(data$gluc == 1, "Normal", ifelse(data$gluc == 2, "Above Normal", "Well Above Normal")))
data$cholesterol <- as.ordered(ifelse(data$cholesterol == 1, "Normal", ifelse(data$cholesterol == 2, "Above Normal", "Well Above Normal")))
data$gender <- as.factor(ifelse(data$gender == 1, "Woman", "Man"))

# converts 'weight' from character to numeric
data$weight <- unfactor(data$weight)

# converts unit of 'age' from days to years
data$age <- round(data$age / 365, digits = 0)

# creates 'BMI' column from corresponding 'height' and 'weight'
data$BMI <- (data$weight / ((data$height * 0.01) ^ 2))

# changes column names to readable format
colnames(data) <- c("Age", "Gender", "Height", "Weight", "Systole", "Diastole", "Cholesterol", "Glucose", "Smoking", "Alcohol", "Active", "Target", "BMI")

head(data)
```

# Exploratory Analysis


## Summary Statistics

From the summary statistics, it is evident that the attributes 'Diastole' and 'Systole' have negative values, which are invalid. Also these two attributes, along with 'Weight' might have lots of outliers which need to be removed.

```{r}
# explores types of the attributes
unlist(sapply(data, class))

# summerizes dataset
summary(data)
```

## Age Distribution

```{r}
ggplot(data) + geom_density(aes(x = Age, fill = Target), alpha=0.8) + ggtitle("Age Density Plot") + xlab("Age") + ylab("Density") + theme_bw() + scale_fill_manual(values=c("#15158a", "#eb4034"))

# saves plot
png(file="../figures/age_dist.png", width=600, height=350)
ggplot(data) + geom_density(aes(x = Age, fill = Target), alpha=0.8) + ggtitle("Age Density Plot") + xlab("Age") + ylab("Density") + theme_bw() + scale_fill_manual(values=c("#15158a", "#eb4034"))
dev.off()
```

## Height Distribution

```{r}
ggplot(data) + geom_density(aes(x = Height, fill = Target), alpha=0.8) + ggtitle("Height Density Plot") + xlab("Height") + ylab("Density") + theme_bw() + scale_fill_manual(values=c("#15158a", "#eb4034"))

# saves plot
png(file="../figures/height_dist.png", width=600, height=350)
ggplot(data) + geom_density(aes(x = Height, fill = Target), alpha=0.8) + ggtitle("Height Density Plot") + xlab("Height") + ylab("Density") + theme_bw() + scale_fill_manual(values=c("#15158a", "#eb4034"))
dev.off()
```

## Weight Distribution

```{r}
ggplot(data) + geom_density(aes(x = Weight, fill = Target), alpha=0.8) + ggtitle("Weight Density Plot") + xlab("Weight") + ylab("Density") + theme_bw() + scale_fill_manual(values=c("#15158a", "#eb4034"))

# saves plot
png(file="../figures/weight_dist.png", width=600, height=350)
ggplot(data) + geom_density(aes(x = Weight, fill = Target), alpha=0.8) + ggtitle("Weight Density Plot") + xlab("Weight") + ylab("Density") + theme_bw() + scale_fill_manual(values=c("#15158a", "#eb4034"))
dev.off()
```

## BMI Distribution

```{r}
ggplot(data) + geom_density(aes(x = BMI, fill = Target), alpha=0.8) + ggtitle("BMI Density Plot") + xlab("BMI") + ylab("Density") + theme_bw() + scale_fill_manual(values=c("#15158a", "#eb4034"))

# saves plot
png(file="../figures/bmi_dist.png", width=600, height=350)
ggplot(data) + geom_density(aes(x = BMI, fill = Target), alpha=0.8) + ggtitle("BMI Density Plot") + xlab("BMI") + ylab("Density") + theme_bw() + scale_fill_manual(values=c("#15158a", "#eb4034"))
dev.off()
```

## Class Distribution

```{r}
ggplot(data) + geom_bar(aes(x = Target, fill = Target), alpha=0.8) + theme_bw() + ggtitle("Class Distribution") + xlab("Target") + ylab("Count") + scale_fill_manual(values=c("#15158a", "#eb4034"))

# saves plot
png(file="../figures/class_dist.png", width=600, height=350)
ggplot(data) + geom_bar(aes(x = Target, fill = Target), alpha=0.8) + theme_bw() + ggtitle("Class Distribution") + xlab("Target") + ylab("Count") + scale_fill_manual(values=c("#15158a", "#eb4034"))
dev.off()
```

## Smoking Distribution

```{r}
ggplot(data) + geom_bar(aes(x = Smoking, fill = Target), position = 'dodge', alpha=0.8) + theme_bw() + ggtitle("Smoking Distribution") + xlab("Smoking") + ylab("Count") + scale_fill_manual(values=c("#15158a", "#eb4034"))

# saves plot
png(file="../figures/smoking_dist.png", width=600, height=350)
ggplot(data) + geom_bar(aes(x = Smoking, fill = Target), position = 'dodge', alpha=0.8) + theme_bw() + ggtitle("Smoking Distribution") + xlab("Smoking") + ylab("Count") + scale_fill_manual(values=c("#15158a", "#eb4034"))
dev.off()
```

## Alcohol Distribution

```{r}
ggplot(data) + geom_bar(aes(x = Alcohol, fill = Target), position = 'dodge', alpha=0.8) + theme_bw() + ggtitle("Alcohol Distribution") + xlab("Alcohol") + ylab("Count") + scale_fill_manual(values=c("#15158a", "#eb4034"))

# saves plot
png(file="../figures/alcohol_dist.png", width=600, height=350)
ggplot(data) + geom_bar(aes(x = Alcohol, fill = Target), position = 'dodge', alpha=0.8) + theme_bw() + ggtitle("Alcohol Distribution") + xlab("Alcohol") + ylab("Count") + scale_fill_manual(values=c("#15158a", "#eb4034"))
dev.off()
```

## Physical Activity Distribution

```{r}
ggplot(data) + geom_bar(aes(x = Active, fill = Target), position = 'dodge', alpha=0.8) + theme_bw() + ggtitle("Physical Activity Distribution") + xlab("Activity") + ylab("Count") + scale_fill_manual(values=c("#15158a", "#eb4034"))

# saves plot
png(file="../figures/activity_dist.png", width=600, height=350)
ggplot(data) + geom_bar(aes(x = Active, fill = Target), position = 'dodge', alpha=0.8) + theme_bw() + ggtitle("Physical Activity Distribution") + xlab("Activity") + ylab("Count") + scale_fill_manual(values=c("#15158a", "#eb4034"))
dev.off()
```

## Gender Distribution

```{r}
ggplot(data) + geom_bar(aes(x = Gender, fill = Target), position = 'dodge', alpha=0.8) + theme_bw() + ggtitle("Gender Distribution") + xlab("Gender") + ylab("Count") + scale_fill_manual(values=c("#15158a", "#eb4034"))

# saves plot
png(file="../figures/gender_dist.png", width=600, height=350)
ggplot(data) + geom_bar(aes(x = Gender, fill = Target), position = 'dodge', alpha=0.8) + theme_bw() + ggtitle("Gender Distribution") + xlab("Gender") + ylab("Count") + scale_fill_manual(values=c("#15158a", "#eb4034"))
dev.off()
```

## Age Vs. Height Scatter Plot

```{r}
ggplot(data, aes(x= Age , y = Height, color = Target)) +  geom_point(alpha = 0.9) + scale_color_manual(values=c("#15158a", "#eb4034")) + stat_smooth() + ggtitle("Age Vs. Height")

# saves plot
png(file="../figures/age_vs_height.png", width=600, height=350)
ggplot(data, aes(x= Age , y = Height, color = Target)) +  geom_point(alpha = 0.9) + scale_color_manual(values=c("#15158a", "#eb4034")) + stat_smooth() + ggtitle("Age Vs. Height")
dev.off()
```

## Height Vs. Weight Scatter Plot

```{r}
ggplot(data, aes(x= Height , y = Weight, color = Target)) +  geom_point(alpha = 0.8) + scale_color_manual(values=c("#15158a", "#eb4034")) + stat_smooth() + ggtitle("Height Vs. Weight")

# saves plot
png(file="../figures/height_vs_weight.png", width=600, height=350)
ggplot(data, aes(x= Height , y = Weight, color = Target)) +  geom_point(alpha = 0.8) + scale_color_manual(values=c("#15158a", "#eb4034")) + stat_smooth() + ggtitle("Height Vs. Weight")
dev.off()
```

## BMI Vs. Systole Scatter Plot

```{r}
ggplot(data, aes(x= BMI , y = Systole, color = Target)) +  geom_point(alpha = 0.8) + scale_color_manual(values=c("#15158a", "#eb4034")) + stat_smooth() + ggtitle("BMI Vs. Systolic Pressure")

# saves plot
png(file="../figures/bmi_vs_systole.png", width=600, height=350)
ggplot(data, aes(x= BMI , y = Systole, color = Target)) +  geom_point(alpha = 0.8) + scale_color_manual(values=c("#15158a", "#eb4034")) + stat_smooth() + ggtitle("BMI Vs. Systolic Pressure")
dev.off()
```

## BMI Vs. Diastole Scatter Plot

```{r}
ggplot(data, aes(x= BMI , y = Diastole, color = Target)) +  geom_point(alpha = 0.8) + scale_color_manual(values=c("#15158a", "#eb4034")) + stat_smooth() + ggtitle("BMI Vs. Diastolic Pressure")

# saves plot
png(file="../figures/bmi_vs_diastole.png", width=600, height=350)
ggplot(data, aes(x= BMI , y = Diastole, color = Target)) +  geom_point(alpha = 0.8) + scale_color_manual(values=c("#15158a", "#eb4034")) + stat_smooth() + ggtitle("BMI Vs. Diastolic Pressure")
dev.off()
```

## Correlation Matrix of Numeric Attributes

```{r}
png(file="../figures/cor_numeric.png", width=600, height=350)
cor <- cor(data[, c("Age", "Height", "Weight", "BMI", "Systole", "Diastole")])
palette = colorRampPalette(c("skyblue", "blue", "yellow"))(20)
heatmap(cor, col = palette, scale = "column")
dev.off()

heatmap(cor, col = palette, scale = "column")
```

# Managing Data

```{r}
# removes observation for which 'ap_hi' or 'ap_lo' has negative values
data <- subset(data, ap_hi > 0 & ap_lo > 0)

# removes 'ap_hi' and 'ap_lo' outliers
iqr_multiplier = 3
ap_hi_upper_threshold <- quantile(data$ap_hi, .75) + iqr_multiplier * (quantile(data$ap_hi, .75) - quantile(data$ap_hi, .25))
ap_hi_lower_threshold <- quantile(data$ap_hi, .25) - iqr_multiplier * (quantile(data$ap_hi, .75) - quantile(data$ap_hi, .25))
ap_lo_upper_threshold <- quantile(data$ap_lo, .75) + iqr_multiplier * (quantile(data$ap_lo, .75) - quantile(data$ap_lo, .25))
ap_lo_lower_threshold <- quantile(data$ap_lo, .25) - iqr_multiplier * (quantile(data$ap_lo, .75) - quantile(data$ap_lo, .25))
data <- subset(data, ap_hi < ap_hi_upper_threshold & ap_hi > ap_hi_lower_threshold & ap_lo < ap_lo_upper_threshold & ap_lo > ap_hi_lower_threshold)

# removes 'weight' outliers
weight_iqr_multiplier = 1.5
weight_upper_threshold <- quantile(data$weight, .75) + weight_iqr_multiplier * (quantile(data$weight, .75) - quantile(data$weight, .25))
weight_lower_threshold <- quantile(data$weight, .25) - weight_iqr_multiplier * (quantile(data$weight, .75) - quantile(data$weight, .25))
data <- subset(data, weight > weight_lower_threshold & weight < weight_upper_threshold)

# summerizes newly encoded dataset
summary(data)
```

# Modeling Data

```{r}

```

